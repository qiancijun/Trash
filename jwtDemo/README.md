# JWT

## 什么是 JWT

[JWT](https://jwt.io/)(JSON Web Token) 是一种开源标准的安全传输 JSON 信息对象的方式。JWT 采用数字签名的方式，所以传递的信息是可以被信任的。绝大多数的 JWT 采用 RSA、ECDSA 进行加密，或者使用公共/私钥算法进行签名。

## 应用场景
* 鉴权：用户登录后，该用户的每个后续请求都应该包含 JWT，其中带有用户允许访问的路由，服务和资源。单个标志是当今广泛使用JWT的功能，因为它的开销很小，并且能够轻松地在不同的域中使用。
* 信息交换：JWT 是双方进行安全信息传输的好的解决方案。因为进行数字加密，可以确保信息传递双方的身份。

# JWT 解析

## 结构
JWT 由三部分组成，他们之间用`.`来进行分割。它们依次是：
  * 标头
  * 载荷（数据）
  * 签名

一个标准的 JWT 的格式为`xxxxx.yyyyy.zzzzz`

### 标头
标头由两部分组成：token 的种类，加密算法。例如：
``` json
{
  "alg": "HS256",
  "typ": "JWT"
}
```
这一部分会进行 Base64 编码作为 JWT 的第一个部分。

### 载荷
通常这部分包含了一个用户的实体对象和其余的额外信息，通常把这部分叫作`Claims`，在载荷中，一共有三种`Claims`，分别是：已注册，公共，私有
  * 已注册：定义了一些预声明的`Claims`，建议在这里提供一些可用的信息，例如：发行人，到期时间等
  * 公共：使用该 JWT 的用户可以随意定义这部分内容，但是为了避免碰撞，应在 IANA JSON Web Token Registry 进行注册。
  * 私有：这些是为在同意使用它们的各方之间共享信息而创建的自定义声明，既不是注册声明也不是公开声明。

一个有效的载荷可能为：
``` json
{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": true
}
```
同样载荷也会采取 Base64 编码作为 JWT 的第二个部分。

### 签名
在标头中我们已经声明了使用何种加密算法，那么加密的流程是什么样子的呢？我们将进行 Base64 编码之后的标头和载荷，以及算法所需要的密钥一同进行加密。
``` txt
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret)
```
进行完加密算法后的数字签名可以验证该消息在整个过程中是否被更改，同时，如果使用的私钥签名的消息，还可以验证 JWT 的发送者身份的真实性。